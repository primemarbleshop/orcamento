<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Cliente</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .phone-input-group {
            display: flex;
            gap: 10px;
        }
        .country-select {
            width: 180px;
        }
        .phone-input-container {
            position: relative;
            flex-grow: 1;
        }
        .phone-format-hint {
            position: absolute;
            top: 50%;
            left: 12px;
            transform: translateY(-50%);
            color: #999;
            pointer-events: none;
            font-size: 0.875rem;
            z-index: 5;
            opacity: 0.8;
            font-weight: 400;
        }
        .phone-input {
            position: relative;
            z-index: 10;
            background: transparent;
        }
        .phone-input:focus + .phone-format-hint,
        .phone-input.filled + .phone-format-hint {
            opacity: 0;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h2>Editar Cliente</h2>
        <form method="POST">
            <div class="mb-3">
                <label for="nome" class="form-label">Nome:</label>
                <input type="text" id="nome" name="nome" class="form-control" value="{{ cliente.nome }}" required>
            </div>
            
            <div class="mb-3">
                <label for="endereco" class="form-label">EndereÃ§o:</label>
                <input type="text" id="endereco" name="endereco" class="form-control" value="{{ cliente.endereco }}">
            </div>
            
            <div class="mb-3">
                <label for="telefone" class="form-label">Telefone:</label>
                <div class="phone-input-group">
                    <select id="pais" name="pais" class="form-select country-select">
                        <option value="BR" data-code="55" data-mask="(00) 00000-0000">ðŸ‡§ðŸ‡· Brasil</option>
                        <option value="US" data-code="1" data-mask="(000) 000-0000">ðŸ‡ºðŸ‡¸ Estados Unidos</option>
                        <option value="PT" data-code="351" data-mask="00 000 0000">ðŸ‡µðŸ‡¹ Portugal</option>
                        <option value="ES" data-code="34" data-mask="000 000 000">ðŸ‡ªðŸ‡¸ Espanha</option>
                        <option value="FR" data-code="33" data-mask="0 00 00 00 00">ðŸ‡«ðŸ‡· FranÃ§a</option>
                        <option value="DE" data-code="49" data-mask="000 00000000">ðŸ‡©ðŸ‡ª Alemanha</option>
                        <option value="IT" data-code="39" data-mask="000 000 0000">ðŸ‡®ðŸ‡¹ ItÃ¡lia</option>
                        <option value="UK" data-code="44" data-mask="0000 000000">ðŸ‡¬ðŸ‡§ Reino Unido</option>
                        <option value="AR" data-code="54" data-mask="000 00-0000">ðŸ‡¦ðŸ‡· Argentina</option>
                        <option value="UY" data-code="598" data-mask="00 000 000">ðŸ‡ºðŸ‡¾ Uruguai</option>
                    </select>
                    <div class="phone-input-container">
                        <input type="text" id="telefone" name="telefone" class="form-control phone-input" value="{{ cliente.telefone }}" required>
                        <div id="phone-format-hint" class="phone-format-hint">(00) 00000-0000</div>
                    </div>
                </div>
                <input type="hidden" id="codigo_pais" name="codigo_pais" value="55">
                <input type="hidden" id="pais_selecionado" name="pais_selecionado" value="BR">
            </div>
            
            <button type="submit" class="btn btn-primary">Atualizar Cliente</button>
            <a href="{{ url_for('clientes') }}" class="btn btn-secondary">Cancelar</a>
        </form>
    </div>

    <script>
        function applyPhoneMask(input, mask) {
            let value = input.value.replace(/\D/g, '');
            let maskedValue = '';
            let maskIndex = 0;
            
            for (let i = 0; i < mask.length && maskIndex < value.length; i++) {
                if (mask[i] === '0') {
                    maskedValue += value[maskIndex];
                    maskIndex++;
                } else {
                    maskedValue += mask[i];
                }
            }
            input.value = maskedValue;
            
            if (input.value.length > 0) {
                input.classList.add('filled');
            } else {
                input.classList.remove('filled');
            }
        }

        function updatePhoneFormat() {
            const countrySelect = document.getElementById('pais');
            const phoneInput = document.getElementById('telefone');
            const formatHint = document.getElementById('phone-format-hint');
            
            const selectedOption = countrySelect.options[countrySelect.selectedIndex];
            const countryCode = selectedOption.getAttribute('data-code');
            const countryMask = selectedOption.getAttribute('data-mask');
            
            phoneInput.placeholder = countryMask;
            document.getElementById('codigo_pais').value = countryCode;
            document.getElementById('pais_selecionado').value = selectedOption.value;
            
            formatHint.textContent = countryMask;
            
            phoneInput.removeEventListener('input', phoneInput._maskHandler);
            phoneInput._maskHandler = function(e) {
                applyPhoneMask(e.target, countryMask);
            };
            phoneInput.addEventListener('input', phoneInput._maskHandler);
        }

        document.addEventListener('DOMContentLoaded', function() {
            const countrySelect = document.getElementById('pais');
            countrySelect.addEventListener('change', updatePhoneFormat);
            updatePhoneFormat();
        });
    </script>
</body>
</html>
