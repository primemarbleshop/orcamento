<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes dos Or√ßamentos</title>
   <style>
    
    /* Reduzir tamanho geral das fontes para 80% do original */
    body {
        font-size: 15px; /* Antes era 16px, agora reduzido 20% */
    }

    /* Reduzindo tamanho das tabelas */
    table {
        width: 100%;
        border-collapse: collapse;
        font-size: 15px; /* Redu√ß√£o de 20% */
    }

    th, td {
        border: 1px solid black;
        padding: 3px; /* Redu√ß√£o leve do espa√ßamento */
        text-align: left;
    }

    th {
        background-color: #f2f2f2;
        font-size: 14px; /* Mantendo maior que o texto normal */
    }

    /* Reduzindo cabe√ßalhos do cliente */
    .cliente-header {
        font-size: 15px; /* Antes era 20px, agora 16px */
        font-weight: bold;
        margin-top: 14px;
        margin-bottom: 7px;
    }

    /* Reduzindo cabe√ßalhos de produtos */
    .produto-header {
        font-size: 15px; /* Antes era 18px, agora 15px */
        font-weight: bold;
        margin-top: 12px;
        margin-bottom: 6px;
    }

    /* Reduzir tamanho do bot√£o de impress√£o */
    .print-button {
        font-size: 14px; /* Antes era 16px */
        padding: 8px;
    }

  

    /* Reduzindo informa√ß√µes do cliente */
    .cliente-info {
        font-size: 13px;
        color: #555;
        font-weight: normal;
    }


.header-container {
    display: flex;
    justify-content: flex-start; /* Mant√©m o t√≠tulo alinhado √† esquerda */
    align-items: center; /* Alinha verticalmente */
    position: relative; /* Define um contexto para posicionar a logo */
    width: 100%; /* Ocupa toda a largura dispon√≠vel */
}

.logo-empresa {
    position: absolute;
    right: 0; /* Move a logo totalmente para o canto direito */
    top: 80px; /* Centraliza verticalmente em rela√ß√£o ao t√≠tulo */
    transform: translateY(-50%); /* Ajuste fino para centralizar exatamente */
    height: 150px; /* Ajuste conforme necess√°rio */
    width: auto; /* Mant√©m a propor√ß√£o */
}
.total-box {
    display: inline-block; /* Faz a largura se ajustar ao conte√∫do */
    background-color: #f8f9fa;
    border: 2px solid #000;
    padding: 8px 12px;
    font-size: 16px;
    font-weight: bold;
    border-radius: 5px;
    box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
    text-align: center;
    margin-bottom: 10px; /* Espa√ßo antes da tabela */
    float: right; /* Move a caixa para o lado direito */
} 
       
.cliente-header h2,
.cliente-header p {
    display: flex;
    align-items: flex-start;
    margin: 3px 0;
}

.cliente-header strong {
    white-space: nowrap;
    margin-right: 5px;
}

.wrap-text {
    display: inline-block;
    max-width: 75%;
    word-wrap: break-word;
}

/* Estilos para o rodap√© */
.orcamento-footer {
    margin-top: 30px;
    padding: 15px;
    border-top: 2px solid #333;
    background-color: #f9f9f9;
    page-break-inside: avoid;
}

.footer-section {
    margin-bottom: 15px;
}

.footer-title {
    font-weight: bold;
    margin-bottom: 5px;
    font-size: 14px;
}

.footer-content {
    font-size: 13px;
}

.edit-mode {
    background-color: #fffde7;
    padding: 10px;
    border: 1px dashed #ccc;
}

.edit-field {
    width: 60px;
    margin: 0 5px;
}

.payment-option {
    margin-bottom: 8px;
    flex: 1;
    min-width: 0;
    padding: 0 10px;
    border-right: 1px solid #ddd;
}

.payment-option:last-child {
    border-right: none;
}

.installment-calc {
    margin-top: 5px;
    font-size: 12px;
    color: #333; /* Tornando mais escuro para melhor visibilidade */
    font-weight: bold; /* Destacando mais */
}

.btn-edit {
    background-color: #4CAF50;
    color: white;
    border: none;
    padding: 5px 10px;
    cursor: pointer;
    margin-top: 10px;
    font-size: 12px;
}

.btn-save {
    background-color: #2196F3;
    color: white;
    border: none;
    padding: 5px 10px;
    cursor: pointer;
    margin-right: 5px;
    font-size: 12px;
}

.btn-cancel {
    background-color: #f44336;
    color: white;
    border: none;
    padding: 5px 10px;
    cursor: pointer;
    font-size: 12px;
}

.payment-options-container {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    margin-top: 10px;
}

.payment-option h4 {
    margin: 0 0 8px 0;
    font-size: 13px;
    color: #000;
}

.payment-detail {
    font-size: 12px;
    margin: 3px 0;
}

.payment-highlight {
    font-weight: bold;
    color: #000;
    background-color: #f0f0f0;
    padding: 3px;
    border-radius: 3px;
}

@media print {
    @page {
       margin: 5mm; /* Margens reduzidas para melhor aproveitamento */
    }

    /* Ajusta a logo para impress√£o */
    .logo-empresa {
        position: absolute;
        top: 5mm;
        right: 10mm;
        height: 120px !important;
        width: auto !important;
    }

      
       body {
            margin: 0;
            padding: 0;
        }

    /* Evita que t√≠tulos sejam separados */
    .produto-header, .cliente-header {
        page-break-after: avoid;
        font-weight: bold;
        font-size: 14px;
    }

    /* Permite quebra de tabelas, se necess√°rio */
    table {
        page-break-inside: auto !important;
        width: 100%;
    }

    th, td {
        border: 1px solid black;
        padding: 4px;
        text-align: left;
        font-size: 10px; /* üî• Fonte menor nas c√©lulas */
    }

    /* Evita que o total seja separado do conte√∫do */
    .total-box {
        font-size: 14px !important;
        padding: 6px !important;
        page-break-before: avoid; /* Mant√©m o total sempre na mesma p√°gina */
        page-break-after: avoid;
    }

    
    /* Evita separa√ß√£o de cliente e produtos */
    .cliente-header {
        page-break-after: avoid;
        font-weight: bold;
        font-size: 14px;
    }

    /* Oculta bot√µes e links na impress√£o */
    .print-button, .btn-voltar {
        display: none !important;
    }
    
    .btn-edit, .btn-save, .btn-cancel {
        display: none !important;
    }
    
    .edit-mode {
        background-color: transparent;
        border: none;
        padding: 0;
    }
    
    input, select {
        border: none;
        background: transparent;
        appearance: none;
        -webkit-appearance: none;
    }
    
    .payment-options-container {
        display: flex;
        justify-content: space-between;
    }
    
    .payment-option {
        flex: 1;
        min-width: 0;
        padding: 0 10px;
        border-right: 1px solid #ddd;
    }
    
    .payment-option:last-child {
        border-right: none;
    }
}

.cliente-header h2,
    .cliente-header p {
        display: block !important; /* Troque flex por block */
        margin: 3px 0 !important;
    }

    .cliente-header strong {
        display: inline !important;
        white-space: nowrap !important;
    }

    .wrap-text {
        display: inline-block !important;
        max-width: 60% !important;
        word-wrap: break-word !important;
        vertical-align: top !important;
    }


.header-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0; /* Remove espa√ßo extra */
}

h1, h2, h3, p {
    margin: 0; /* Remove qualquer margem extra */
    padding: 0; /* Remove espa√ßamentos internos */
    line-height: 1.2; /* Ajusta a altura da linha para reduzir espa√ßos verticais */
}

.empresa-header, .cliente-header {
    margin-bottom: 5px; /* Mant√©m um pequeno espa√ßamento */
}

.empresa-header h1, .cliente-header h2 {
    font-size: 18px; /* Define o mesmo tamanho para os t√≠tulos */
    margin-bottom: 3px; /* Reduz o espa√ßo abaixo do t√≠tulo */
    font-weight: bold;
}

p strong {
    font-weight: bold; /* Mant√©m o r√≥tulo em negrito */
}

.info-normal {
    font-weight: normal; /* Remove o negrito dos dados do cliente */
}

.detalhes-orcamento {
    margin-top: 5px; /* Reduz espa√ßo antes do t√≠tulo "Detalhes do Or√ßamento" */
}
</style>
</head>
<body>
<div class="header-container">
    <img src="{{ logo_url }}" alt="Logo da Empresa" class="logo-empresa">
</div>

<div class="empresa-header">
    <h1>Prime Marble Shop</h1>
    <p><strong>Endere√ßo:</strong> Estrada do Engenho, 1800 - Bangu</p>
    <p><strong>CNPJ:</strong> 39.903.780/0001-15</p>
    <!-- ADICIONANDO O TELEFONE DO USU√ÅRIO AQUI -->
    <p><strong>Telefone:</strong> <span class="info-normal">{{ telefone_usuario }}</span></p>
</div>

<div class="cliente-header">
    <h2>
        <strong>Cliente:</strong>
        <span class="wrap-text">{{ cliente_nome }}</span>
    </h2>
    <p>
        <strong>Endere√ßo:</strong>
        <span class="wrap-text info-normal">{{ orcamentos[0].cliente.endereco }}</span>
    </p>
    <p>
        <strong>Telefone:</strong>
        <span class="info-normal">{{ orcamentos[0].cliente.telefone }}</span>
    </p>
</div>


<h2>Detalhes do Or√ßamento</h2>
<p class="orcamento-info">
    <strong>Or√ßamento:</strong> {{ codigo_orcamento }}<br>
    <strong>Data:</strong> {{ data_salvo.strftime('%d/%m/%Y') }}
</p>
<div class="total-box">
    Valor Total: <span id="valorTotal">{{ valor_total_final }}</span>
    </div>


<br>

{% set tipos_produtos = {} %}

{% for orcamento in orcamentos %}
    {% if orcamento.tipo_produto not in tipos_produtos %}
        {% set tipos_produtos = tipos_produtos.update({orcamento.tipo_produto: []}) or tipos_produtos %}
    {% endif %}
    {% set _ = tipos_produtos[orcamento.tipo_produto].append(orcamento) %}
{% endfor %}

{% for tipo, produtos in tipos_produtos.items() %}
    <div class="produto-header"> {{ tipo }}</div>
    <table>
        <thead>
            <tr>
                <th>Material</th>
                <th>Qtd</th>
                <th>Comp.</th>
                <th>Larg.</th>
                {% if tipo in ["Bancada", "Lavatorio", "Ilharga", "Ilharga Bipolida"] %}
                <th>Saia</th>
                {% endif %}
                {% if tipo in ["Bancada", "Lavatorio"] %}
                <th>Fronte</th>
                {% endif %}
                {% if tipo in ["Bancada", "Lavatorio"] %}
                <th>Cuba</th>
                {% endif %}
                {% if tipo == "Bancada" %}
                <th>Cooktop</th>
                {% endif %}
                {% if tipo in ["Nicho", "Nicho Sem Fundo"] %}
                <th>Profundidade</th>
                <th>Fundo</th>
                <th>Alisar</th>
                <th>Larg. do Alisar</th>
                {% endif %}
                <th>Outros Custos</th>
                <th>Valor</th>
            </tr>
        </thead>
        <tbody>
            {% for produto in produtos %}
            <tr>
                <td>{{ produto.material.nome }}</td>
                <td>{{ produto.quantidade }}</td>
                <td>{{ produto.comprimento }} cm</td>
                <td>{{ produto.largura }} cm</td>
                {% if tipo in ["Bancada", "Lavatorio", "Ilharga", "Ilharga Bipolida"] %}
                <td>{{ produto.comprimento_saia }} x {{ produto.largura_saia }} cm</td>
                {% endif %}
                {% if tipo in ["Bancada", "Lavatorio"] %}
                <td>{{ produto.comprimento_fronte }} x {{ produto.largura_fronte }} cm</td>
                {% endif %}
                {% if tipo in ["Bancada", "Lavatorio"] %}
                <td>
                    {% if produto.tipo_cuba == "Esculpida" %}
                        Esculpida ({{ produto.quantidade_cubas }}) - {{ produto.comprimento_cuba }} x {{ produto.largura_cuba }} x {{ produto.profundidade_cuba }} cm
                    {% elif produto.tipo_cuba %}
                        {{ produto.tipo_cuba }} ({{ produto.quantidade_cubas }})
                    {% else %}
                        -
                    {% endif %}
                </td>
                {% endif %}
                {% if tipo == "Bancada" %}
                <td>{% if produto.tem_cooktop == "Sim" %}Sim{% else %}-{% endif %}</td>
                {% endif %}
                {% if tipo in ["Nicho", "Nicho Sem Fundo"] %}
                <td>{{ produto.profundidade_nicho }} cm</td>
                <td>{% if produto.tem_fundo == "Sim" %}Sim{% else %}N√£o{% endif %}</td>
                <td>{% if produto.tem_alisar == "Sim" %}Sim{% else %}N√£o{% endif %}</td>
                <td>{% if produto.tem_alisar == "Sim" %}{{ produto.largura_alisar }} cm{% else %}-{% endif %}</td>
                {% endif %}
                <td>R$ {{ "%.2f"|format(produto.outros_custos) }}</td>
                <td class="valor-tabela">R$ {{ "%.2f"|format(produto.valor_total) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endfor %}

<!-- Rodap√© do or√ßamento -->
<div class="orcamento-footer">
    <div class="footer-section">
        <div class="footer-title">Prazo de Entrega:</div>
        <div class="footer-content">
            <span id="deliveryDaysDisplay">{{ prazo_entrega }}</span> dias √∫teis
            <button class="btn-edit" onclick="toggleEdit('deliveryDays')">Editar</button>
            
            <div id="deliveryDaysEdit" class="edit-mode" style="display: none;">
                <input type="number" id="deliveryDaysInput" class="edit-field" value="{{ prazo_entrega }}" min="1">
                dias √∫teis
                <button class="btn-save" onclick="saveValue('deliveryDays')">Salvar</button>
                <button class="btn-cancel" onclick="cancelEdit('deliveryDays')">Cancelar</button>
            </div>
        </div>
    </div>
    
    <div class="footer-section">
        <div class="footer-title">Condi√ß√µes de Pagamento:</div>
        <div class="footer-content">
            <div class="payment-options-container">
                <!-- Cart√£o de Cr√©dito (agora primeiro) -->
                <div class="payment-option">
                    <h4>3. Cart√£o de Cr√©dito</h4>
                     <div class="installment-calc payment-highlight">
                        Op√ß√µes de parcelamento:
                        <span id="parcelamentoCartao">
                            {% for i in range(1, 11) %}
                                {% set parcela = valor_total_float / i %}
                                {% if parcela >= 100 or i == 1 %}
                                    {{ i }}x de R$ {{ "%.2f"|format(parcela) }}{% if not loop.last %}, {% endif %}
                                {% endif %}
                            {% endfor %}
                        </span>
                    </div>
                </div>
                
                <!-- √Ä vista (Dinheiro/PIX) -->
                <div class="payment-option">
                    <h4>1. √Ä vista (Dinheiro/PIX)</h4>
                    <div class="payment-detail">
                        <span id="discount1Display">{{ desconto_avista }}</span>% de desconto
                        <button class="btn-edit" onclick="toggleEdit('discount1')">Editar</button>
                    </div>
                    <div class="payment-detail">‚Ä¢ Sinal de 50% e 50% na entrega</div>
                    <div class="installment-calc payment-highlight">
                        Valor com desconto: R$ <span id="valorAvista">{{ "%.2f"|format(valor_total_float * (1 - desconto_avista/100)) }}</span>
                    </div>
                    
                    <div id="discount1Edit" class="edit-mode" style="display: none;">
                        <input type="number" id="discount1Input" class="edit-field" value="{{ desconto_avista }}" min="0" max="100">% de desconto
                        <button class="btn-save" onclick="saveValue('discount1')">Salvar</button>
                        <button class="btn-cancel" onclick="cancelEdit('discount1')">Cancelar</button>
                    </div>
                </div>
                
                <!-- Parcelado (Dinheiro/PIX) -->
                <div class="payment-option">
                    <h4>2. Parcelado (Dinheiro/PIX)</h4>
                    <div class="payment-detail">
                        <span id="discount2Display">{{ desconto_parcelado }}</span>% de desconto
                        <button class="btn-edit" onclick="toggleEdit('discount2')">Editar</button>
                    </div>
                    <div class="payment-detail">‚Ä¢ Sinal de 80% e 20% na entrega</div>
                    <div class="installment-calc payment-highlight">
                        Valor com desconto: R$ <span id="valorParcelado">{{ "%.2f"|format(valor_total_float * (1 - desconto_parcelado/100)) }}</span>
                    </div>
                    
                    <div id="discount2Edit" class="edit-mode" style="display: none;">
                        <input type="number" id="discount2Input" class="edit-field" value="{{ desconto_parcelado }}" min="0" max="100">% de desconto
                        <button class="btn-save" onclick="saveValue('discount2')">Salvar</button>
                        <button class="btn-cancel" onclick="cancelEdit('discount2')">Cancelar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="footer-section">
        <div class="footer-title">Observa√ß√µes:</div>
        <div class="footer-content">
            <div id="observacoesDisplay">{{ observacoes }}</div>
            <button class="btn-edit" onclick="toggleEdit('observacoes')">Editar</button>
            
            <div id="observacoesEdit" class="edit-mode" style="display: none;">
                <textarea id="observacoesInput" rows="3" style="width: 100%;">{{ observacoes }}</textarea>
                <button class="btn-save" onclick="saveValue('observacoes')">Salvar</button>
                <button class="btn-cancel" onclick="cancelEdit('observacoes')">Cancelar</button>
            </div>
        </div>
    </div>
</div>

<br>

<!-- Bot√£o de impress√£o -->
{% if not pdf %}
    <!--<button class="print-button" onclick="window.print()">Imprimir</button> -->
    </br>
    <button onclick="window.location.href='/gerar_pdf_orcamento/{{ codigo_orcamento }}'">Gerar PDF</button>
    </br>
    </br>
    <h2><a href="/orcamentos_salvos" class="btn-voltar">Voltar para Or√ßamentos Salvos</a></h2>
{% endif %}
</br>
</br>
</br>
</br>
</br>
</br>
</br>
</br>    
</br>
</br>

<script>
    // Vari√°veis globais para armazenar os valores
    let valoresOriginais = {};
    const valorTotalFloat = {{ valor_total_float }};
    
    // Fun√ß√£o para alternar entre modo de visualiza√ß√£o e edi√ß√£o
    function toggleEdit(campo) {
        const displayElement = document.getElementById(campo + 'Display');
        const editElement = document.getElementById(campo + 'Edit');
        
        // Salvar valor original para poss√≠vel cancelamento
        if (campo === 'observacoes') {
            valoresOriginais[campo] = document.getElementById(campo + 'Input').value;
        } else {
            valoresOriginais[campo] = document.getElementById(campo + 'Input').value;
        }
        
        // Alternar visibilidade
        displayElement.style.display = 'none';
        editElement.style.display = 'block';
    }
    
    // Fun√ß√£o para salvar valores editados
    function saveValue(campo) {
        const displayElement = document.getElementById(campo + 'Display');
        const editElement = document.getElementById(campo + 'Edit');
        const inputElement = document.getElementById(campo + 'Input');
        
        // Atualizar valor exibido
        if (campo === 'observacoes') {
            displayElement.innerHTML = inputElement.value.replace(/\n/g, '<br>');
        } else {
            displayElement.textContent = inputElement.value;
            
            // Atualizar c√°lculos se for desconto
            if (campo === 'discount1' || campo === 'discount2') {
                atualizarCalculos();
            }
        }
        
        // Voltar para modo de visualiza√ß√£o
        displayElement.style.display = 'block';
        editElement.style.display = 'none';
        
        // Aqui voc√™ pode adicionar c√≥digo para salvar no servidor se necess√°rio
    }
    
    // Fun√ß√£o para cancelar edi√ß√£o
    function cancelEdit(campo) {
        const displayElement = document.getElementById(campo + 'Display');
        const editElement = document.getElementById(campo + 'Edit');
        const inputElement = document.getElementById(campo + 'Input');
        
        // Restaurar valor original
        inputElement.value = valoresOriginais[campo];
        
        // Voltar para modo de visualiza√ß√£o
        displayElement.style.display = 'block';
        editElement.style.display = 'none';
    }
    
    // Fun√ß√£o para atualizar c√°lculos de valores com desconto
    function atualizarCalculos() {
        const desconto1 = parseFloat(document.getElementById('discount1Input').value);
        const desconto2 = parseFloat(document.getElementById('discount2Input').value);
        
        document.getElementById('valorAvista').textContent = (valorTotalFloat * (1 - desconto1/100)).toFixed(2).replace('.', ',');
        document.getElementById('valorParcelado').textContent = (valorTotalFloat * (1 - desconto2/100)).toFixed(2).replace('.', ',');
        
        // Atualizar parcelamento cart√£o
        atualizarParcelamentoCartao(valorTotalFloat);
    }
    
    // Fun√ß√£o para atualizar op√ß√µes de parcelamento no cart√£o
    function atualizarParcelamentoCartao(valorTotal) {
        let opcoesParcelamento = [];
        
        for (let i = 1; i <= 10; i++) {
            const valorParcela = valorTotal / i;
            if (valorParcela >= 100 || i === 1) {
                opcoesParcelamento.push(`${i}x de R$ ${valorParcela.toFixed(2).replace('.', ',')}`);
            }
        }
        
        document.getElementById('parcelamentoCartao').textContent = opcoesParcelamento.join(', ');
    }
    
    // Inicializar c√°lculos quando a p√°gina carregar
    document.addEventListener('DOMContentLoaded', function() {
        atualizarParcelamentoCartao(valorTotalFloat);
    });
</script>
    
</body>
</html>
