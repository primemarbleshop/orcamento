<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes dos OrÃ§amentos</title>
   <style>
    
    /* ðŸ”¥ Reduzindo tamanho geral das fontes */
    body {
        font-size: 15px;
    }

    /* ðŸ”¥ Reduzindo tamanho das tabelas */
    table {
        width: 100%;
        border-collapse: collapse;
        font-size: 15px;
    }

    th, td {
        border: 1px solid black;
        padding: 3px;
        text-align: left;
    }

    th {
        background-color: #f2f2f2;
        font-size: 14px;
    }

    /* ðŸ”¥ Organizando a Ã¡rea do cliente e logo */
    .header-container {
        display: flex;
        justify-content: space-between; /* ðŸ”¥ MantÃ©m os elementos alinhados */
        align-items: flex-start; /* ðŸ”¥ MantÃ©m alinhado no topo */
        width: 100%;
        margin-bottom: 10px;
    }

    .cliente-info {
        max-width: 60%; /* ðŸ”¥ Garante que o nome e endereÃ§o quebrem antes da logo */
        word-wrap: break-word;
        overflow-wrap: break-word;
        display: inline-block;
    }

    .cliente-nome, .cliente-endereco {
        font-size: 14px; /* ðŸ”¥ Ajuste fino do tamanho da fonte */
    }

    .logo-container {
        width: 30%; /* ðŸ”¥ EspaÃ§o reservado para a logo */
        text-align: right;
    }

    .logo-empresa {
        height: 100px !important; /* ðŸ”¥ Ajuste fino do tamanho da logo */
        width: auto !important;
    }

    .total-box {
        display: inline-block;
        background-color: #f8f9fa;
        border: 2px solid #000;
        padding: 8px 12px;
        font-size: 16px;
        font-weight: bold;
        border-radius: 5px;
        text-align: center;
        float: right;
    } 

    @media print {
        @page {
            margin: 5mm;
        }

        /* ðŸ”¥ Evita que o nome e endereÃ§o invadam a logo */
        .cliente-info {
            max-width: 60%;
            word-wrap: break-word;
            overflow-wrap: break-word;
            display: inline-block;
        }

        /* ðŸ”¥ Ajusta a logo na impressÃ£o */
        .logo-container {
            width: 30%;
            text-align: right;
        }

        .logo-empresa {
            height: 80px !important;
            width: auto !important;
        }

        /* ðŸ”¥ Evita separaÃ§Ã£o de cliente e produtos */
        .cliente-header {
            page-break-after: avoid;
            font-weight: bold;
            font-size: 14px;
        }

        /* ðŸ”¥ Ajuste das tabelas na impressÃ£o */
        table {
            page-break-inside: auto !important;
            width: 100%;
        }

        th, td {
            border: 1px solid black;
            padding: 4px;
            text-align: left;
            font-size: 10px;
        }

        /* ðŸ”¥ MantÃ©m o total sempre na mesma pÃ¡gina */
        .total-box {
            font-size: 14px !important;
            padding: 6px !important;
            page-break-before: avoid;
            page-break-after: avoid;
        }

        /* ðŸ”¥ Oculta botÃµes na impressÃ£o */
        .print-button, .btn-voltar {
            display: none !important;
        }
    }
</style>
</head>
<body>

<!-- ðŸ”¥ CabeÃ§alho da Empresa -->
<div class="empresa-header">
    <h1>Prime Marble Shop</h1>
    <p><strong>EndereÃ§o:</strong> Estrada do Engenho, 1800 - Bangu</p>
    <p><strong>CNPJ:</strong> 39.903.780/0001-15</p>
</div>

<!-- ðŸ”¥ Header com Nome do Cliente e Logo -->
<div class="header-container">
    <div class="cliente-info">
        <p class="cliente-nome"><strong>Cliente:</strong> {{ cliente_nome }}</p>
        <p class="cliente-endereco"><strong>EndereÃ§o:</strong> {{ orcamentos[0].cliente.endereco }}</p>
        <p><strong>Telefone:</strong> {{ orcamentos[0].cliente.telefone }}</p>
    </div>
    <div class="logo-container">
        <img src="{{ logo_url }}" alt="Logo da Empresa" class="logo-empresa">
    </div>
</div>


<h2>Detalhes do OrÃ§amento</h2>
<p class="orcamento-info">
    <strong>OrÃ§amento:</strong> {{ codigo_orcamento }}<br>
    <strong>Data:</strong> {{ data_salvo.strftime('%d/%m/%Y') }}
</p>
<div class="total-box">
    Valor Total: <span id="valorTotal">{{ valor_total_final }}</span>
    </div>


<br>

{% set tipos_produtos = {} %}

{% for orcamento in orcamentos %}
    {% if orcamento.tipo_produto not in tipos_produtos %}
        {% set tipos_produtos = tipos_produtos.update({orcamento.tipo_produto: []}) or tipos_produtos %}
    {% endif %}
    {% set _ = tipos_produtos[orcamento.tipo_produto].append(orcamento) %}
{% endfor %}

{% for tipo, produtos in tipos_produtos.items() %}
    <div class="produto-header"> {{ tipo }}</div>
    <table>
        <thead>
            <tr>
                <th>Material</th>
                <th>Qtd</th>
                <th>Comp.</th>
                <th>Larg.</th>
                {% if tipo in ["Bancada", "Lavatorio", "Ilharga", "Ilharga Bipolida"] %}
                <th>Saia</th>
                {% endif %}
                {% if tipo in ["Bancada", "Lavatorio"] %}
                <th>Fronte</th>
                {% endif %}
                {% if tipo in ["Bancada", "Lavatorio"] %}
                <th>Cuba</th>
                {% endif %}
                {% if tipo == "Bancada" %}
                <th>Cooktop</th>
                {% endif %}
                {% if tipo in ["Nicho", "Nicho Sem Fundo"] %}
                <th>Profundidade</th>
                <th>Fundo</th>
                <th>Alisar</th>
                <th>Largura do Alisar</th>
                {% endif %}
                <th>Outros Custos</th>
                <th>Valor Total</th>
            </tr>
        </thead>
        <tbody>
            {% for produto in produtos %}
            <tr>
                <td>{{ produto.material.nome }}</td>
                <td>{{ produto.quantidade }}</td>
                <td>{{ produto.comprimento }} cm</td>
                <td>{{ produto.largura }} cm</td>
                {% if tipo in ["Bancada", "Lavatorio", "Ilharga", "Ilharga Bipolida"] %}
                <td>{{ produto.comprimento_saia }} x {{ produto.largura_saia }} cm</td>
                {% endif %}
                {% if tipo in ["Bancada", "Lavatorio"] %}
                <td>{{ produto.comprimento_fronte }} x {{ produto.largura_fronte }} cm</td>
                {% endif %}
                {% if tipo in ["Bancada", "Lavatorio"] %}
                <td>
                    {% if produto.tipo_cuba == "Esculpida" %}
                        Esculpida ({{ produto.quantidade_cubas }}) - {{ produto.comprimento_cuba }} x {{ produto.largura_cuba }} x {{ produto.profundidade_cuba }} cm
                    {% elif produto.tipo_cuba %}
                        {{ produto.tipo_cuba }} ({{ produto.quantidade_cubas }})
                    {% else %}
                        -
                    {% endif %}
                </td>
                {% endif %}
                {% if tipo == "Bancada" %}
                <td>{% if produto.tem_cooktop == "Sim" %}Sim{% else %}-{% endif %}</td>
                {% endif %}
                {% if tipo in ["Nicho", "Nicho Sem Fundo"] %}
                <td>{{ produto.profundidade_nicho }} cm</td>
                <td>{% if produto.tem_fundo == "Sim" %}Sim{% else %}NÃ£o{% endif %}</td>
                <td>{% if produto.tem_alisar == "Sim" %}Sim{% else %}NÃ£o{% endif %}</td>
                <td>{% if produto.tem_alisar == "Sim" %}{{ produto.largura_alisar }} cm{% else %}-{% endif %}</td>
                {% endif %}
                <td>R$ {{ "%.2f"|format(produto.outros_custos) }}</td>
                <td class="valor-tabela">R$ {{ "%.2f"|format(produto.valor_total) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endfor %}

<br>

<!-- BotÃ£o de impressÃ£o -->
{% if not pdf %}
    <!--<button class="print-button" onclick="window.print()">Imprimir</button> -->
    </br>
    <button onclick="window.location.href='/gerar_pdf_orcamento/{{ codigo_orcamento }}'">Gerar PDF</button>
    </br>
    </br>
    <h2><a href="/orcamentos_salvos" class="btn-voltar">Voltar para OrÃ§amentos Salvos</a></h2>
{% endif %}
</br>
</br>
</br>
</br>
</br>
</br>
</br>
</br>    
</br>
</br>

    
</body>
</html>
